!function(root,factory){"function"==typeof define&&define.amd?define([],factory):"object"==typeof exports?module.exports=factory():root.X2JS=factory()}(this,function(){return function(config){"use strict";function initConfigDefaults(){void 0===config.escapeMode&&(config.escapeMode=!0),config.attributePrefix=config.attributePrefix||"_",config.arrayAccessForm=config.arrayAccessForm||"none",config.emptyNodeForm=config.emptyNodeForm||"text",void 0===config.enableToStringFunc&&(config.enableToStringFunc=!0),config.arrayAccessFormPaths=config.arrayAccessFormPaths||[],void 0===config.skipEmptyTextNodesForObj&&(config.skipEmptyTextNodesForObj=!0),void 0===config.stripWhitespaces&&(config.stripWhitespaces=!0),config.datetimeAccessFormPaths=config.datetimeAccessFormPaths||[],void 0===config.useDoubleQuotes&&(config.useDoubleQuotes=!1),config.xmlElementsFilter=config.xmlElementsFilter||[],config.jsonPropertiesFilter=config.jsonPropertiesFilter||[],void 0===config.keepCData&&(config.keepCData=!1),config.parseNumbers=config.parseNumbers||!1}function initRequiredPolyfills(){}function getNodeLocalName(node){var nodeLocalName=node.localName;return null==nodeLocalName&&(nodeLocalName=node.baseName),null!=nodeLocalName&&""!=nodeLocalName||(nodeLocalName=node.nodeName),nodeLocalName}function getNodePrefix(node){return node.prefix}function escapeXmlChars(str){return"string"==typeof str?str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):str}function checkInStdFiltersArrayForm(stdFiltersArrayForm,obj,name,path){for(var idx=0;idx<stdFiltersArrayForm.length;idx++){var filterPath=stdFiltersArrayForm[idx];if("string"==typeof filterPath){if(filterPath==path)break}else if(filterPath instanceof RegExp){if(filterPath.test(path))break}else if("function"==typeof filterPath&&filterPath(obj,name,path))break}return idx!=stdFiltersArrayForm.length}function toArrayAccessForm(obj,childName,path){switch(config.arrayAccessForm){case"property":obj[childName]instanceof Array?obj[childName+"_asArray"]=obj[childName]:obj[childName+"_asArray"]=[obj[childName]]}!(obj[childName]instanceof Array)&&config.arrayAccessFormPaths.length>0&&checkInStdFiltersArrayForm(config.arrayAccessFormPaths,obj,childName,path)&&(obj[childName]=[obj[childName]])}function fromXmlDateTime(prop){var bits=prop.split(/[-T:+Z]/g),d=new Date(bits[0],bits[1]-1,bits[2]),secondBits=bits[5].split(".");if(d.setHours(bits[3],bits[4],secondBits[0]),secondBits.length>1&&d.setMilliseconds(secondBits[1]),bits[6]&&bits[7]){var offsetMinutes=60*bits[6]+Number(bits[7]),sign=/\d\d-\d\d:\d\d$/.test(prop)?"-":"+";offsetMinutes=0+("-"==sign?-1*offsetMinutes:offsetMinutes),d.setMinutes(d.getMinutes()-offsetMinutes-d.getTimezoneOffset())}else prop.indexOf("Z",prop.length-1)!==-1&&(d=new Date(Date.UTC(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours(),d.getMinutes(),d.getSeconds(),d.getMilliseconds())));return d}function checkFromXmlDateTimePaths(value,childName,fullPath){if(config.datetimeAccessFormPaths.length>0){var path=fullPath.split(".#")[0];return checkInStdFiltersArrayForm(config.datetimeAccessFormPaths,value,childName,path)?fromXmlDateTime(value):value}return value}function checkXmlElementsFilter(obj,childType,childName,childPath){return!(childType==DOMNodeTypes.ELEMENT_NODE&&config.xmlElementsFilter.length>0)||checkInStdFiltersArrayForm(config.xmlElementsFilter,obj,childName,childPath)}function parseDOMChildren(node,path){if(node.nodeType==DOMNodeTypes.DOCUMENT_NODE){for(var result=new Object,nodeChildren=node.childNodes,cidx=0;cidx<nodeChildren.length;cidx++){var child=nodeChildren.item(cidx);if(child.nodeType==DOMNodeTypes.ELEMENT_NODE){var childName=getNodeLocalName(child);result[childName]=parseDOMChildren(child,childName)}}return result}if(node.nodeType==DOMNodeTypes.ELEMENT_NODE){var result=new Object;result.__cnt=0;for(var nodeChildren=node.childNodes,cidx=0;cidx<nodeChildren.length;cidx++){var child=nodeChildren.item(cidx),childName=getNodeLocalName(child);if(child.nodeType!=DOMNodeTypes.COMMENT_NODE){var childPath=path+"."+childName;checkXmlElementsFilter(result,child.nodeType,childName,childPath)&&(result.__cnt++,null==result[childName]?(result[childName]=parseDOMChildren(child,childPath),toArrayAccessForm(result,childName,childPath)):(null!=result[childName]&&(result[childName]instanceof Array||(result[childName]=[result[childName]],toArrayAccessForm(result,childName,childPath))),result[childName][result[childName].length]=parseDOMChildren(child,childPath)))}}for(var aidx=0;aidx<node.attributes.length;aidx++){var attr=node.attributes.item(aidx);result.__cnt++,result[config.attributePrefix+attr.name]=attr.value}var nodePrefix=getNodePrefix(node);return null!=nodePrefix&&""!=nodePrefix&&(result.__cnt++,result.__prefix=nodePrefix),null!=result["#text"]&&(result.__text=result["#text"],result.__text instanceof Array&&(result.__text=result.__text.join("\n")),config.stripWhitespaces&&(result.__text=result.__text.trim()),delete result["#text"],"property"==config.arrayAccessForm&&delete result["#text_asArray"],result.__text=checkFromXmlDateTimePaths(result.__text,childName,path+"."+childName)),null!=result["#cdata-section"]&&(result.__cdata=result["#cdata-section"],delete result["#cdata-section"],"property"==config.arrayAccessForm&&delete result["#cdata-section_asArray"]),0==result.__cnt&&"text"==config.emptyNodeForm?result="":1==result.__cnt&&null!=result.__text?result=result.__text:1!=result.__cnt||null==result.__cdata||config.keepCData?result.__cnt>1&&null!=result.__text&&config.skipEmptyTextNodesForObj?(config.stripWhitespaces&&""==result.__text||""==result.__text.trim())&&delete result.__text:result.__cnt>1&&null!=result.__text&&/^[-+]?[0-9]*\.?[0-9]+$/.test(result.__text)&&config.parseNumbers&&(result.__text=parseFloat(result.__text)):result=result.__cdata,delete result["#text"],delete result.__cnt,!config.enableToStringFunc||null==result.__text&&null==result.__cdata||(result.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),result}if(node.nodeType==DOMNodeTypes.TEXT_NODE||node.nodeType==DOMNodeTypes.CDATA_SECTION_NODE)return node.nodeValue}function startTag(jsonObj,element,attrList,closed){var resultStr="<"+(null!=jsonObj&&null!=jsonObj.__prefix?jsonObj.__prefix+":":"")+element;if(null!=attrList)for(var aidx=0;aidx<attrList.length;aidx++){var attrName=attrList[aidx],attrVal=jsonObj[attrName];config.escapeMode&&(attrVal=escapeXmlChars(attrVal)),resultStr+=" "+attrName.substr(config.attributePrefix.length)+"=",resultStr+=config.useDoubleQuotes?'"'+attrVal+'"':"'"+attrVal+"'"}return resultStr+=closed?"/>":">"}function endTag(jsonObj,elementName){return"</"+(null!=jsonObj.__prefix?jsonObj.__prefix+":":"")+elementName+">"}function endsWith(str,suffix){return str.indexOf(suffix,str.length-suffix.length)!==-1}function jsonXmlSpecialElem(jsonObj,jsonObjField){return!!("property"==config.arrayAccessForm&&endsWith(jsonObjField.toString(),"_asArray")||0==jsonObjField.toString().indexOf(config.attributePrefix)||0==jsonObjField.toString().indexOf("__")||jsonObj[jsonObjField]instanceof Function)}function jsonXmlElemCount(jsonObj){var elementsCnt=0;if(jsonObj instanceof Object)for(var it in jsonObj)jsonXmlSpecialElem(jsonObj,it)||elementsCnt++;return elementsCnt}function checkJsonObjPropertiesFilter(jsonObj,propertyName,jsonObjPath){return 0==config.jsonPropertiesFilter.length||""==jsonObjPath||checkInStdFiltersArrayForm(config.jsonPropertiesFilter,jsonObj,propertyName,jsonObjPath)}function parseJSONAttributes(jsonObj){var attrList=[];if(jsonObj instanceof Object)for(var ait in jsonObj)ait.toString().indexOf("__")==-1&&0==ait.toString().indexOf(config.attributePrefix)&&attrList.push(ait);return attrList}function parseJSONTextAttrs(jsonTxtObj){var result="";return null!=jsonTxtObj.__cdata&&(result+="<![CDATA["+jsonTxtObj.__cdata+"]]>"),null!=jsonTxtObj.__text&&(result+=config.escapeMode?escapeXmlChars(jsonTxtObj.__text):jsonTxtObj.__text),result}function parseJSONTextObject(jsonTxtObj){var result="";return jsonTxtObj instanceof Object?result+=parseJSONTextAttrs(jsonTxtObj):null!=jsonTxtObj&&(result+=config.escapeMode?escapeXmlChars(jsonTxtObj):jsonTxtObj),result}function getJsonPropertyPath(jsonObjPath,jsonPropName){return""===jsonObjPath?jsonPropName:jsonObjPath+"."+jsonPropName}function parseJSONArray(jsonArrRoot,jsonArrObj,attrList,jsonObjPath){var result="";if(0==jsonArrRoot.length)result+=startTag(jsonArrRoot,jsonArrObj,attrList,!0);else for(var arIdx=0;arIdx<jsonArrRoot.length;arIdx++)result+=startTag(jsonArrRoot[arIdx],jsonArrObj,parseJSONAttributes(jsonArrRoot[arIdx]),!1),result+=parseJSONObject(jsonArrRoot[arIdx],getJsonPropertyPath(jsonObjPath,jsonArrObj)),result+=endTag(jsonArrRoot[arIdx],jsonArrObj);return result}function parseJSONObject(jsonObj,jsonObjPath){var result="",elementsCnt=jsonXmlElemCount(jsonObj);if(elementsCnt>0)for(var it in jsonObj)if(!jsonXmlSpecialElem(jsonObj,it)&&(""==jsonObjPath||checkJsonObjPropertiesFilter(jsonObj,it,getJsonPropertyPath(jsonObjPath,it)))){var subObj=jsonObj[it],attrList=parseJSONAttributes(subObj);if(null==subObj||void 0==subObj)result+=startTag(subObj,it,attrList,!0);else if(subObj instanceof Object)if(subObj instanceof Array)result+=parseJSONArray(subObj,it,attrList,jsonObjPath);else if(subObj instanceof Date)result+=startTag(subObj,it,attrList,!1),result+=subObj.toISOString(),result+=endTag(subObj,it);else{var subObjElementsCnt=jsonXmlElemCount(subObj);subObjElementsCnt>0||null!=subObj.__text||null!=subObj.__cdata?(result+=startTag(subObj,it,attrList,!1),result+=parseJSONObject(subObj,getJsonPropertyPath(jsonObjPath,it)),result+=endTag(subObj,it)):result+=startTag(subObj,it,attrList,!0)}else result+=startTag(subObj,it,attrList,!1),result+=parseJSONTextObject(subObj),result+=endTag(subObj,it)}return result+=parseJSONTextObject(jsonObj)}var VERSION="1.2.0";config=config||{},initConfigDefaults(),initRequiredPolyfills();var DOMNodeTypes={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(xmlDocStr){var isIEParser=window.ActiveXObject||"ActiveXObject"in window;if(void 0===xmlDocStr)return null;var xmlDoc;if(window.DOMParser){var parser=new window.DOMParser,parsererrorNS=null;if(!isIEParser)try{parsererrorNS=parser.parseFromString("INVALID","text/xml").getElementsByTagName("parsererror")[0].namespaceURI}catch(err){parsererrorNS=null}try{xmlDoc=parser.parseFromString(xmlDocStr,"text/xml"),null!=parsererrorNS&&xmlDoc.getElementsByTagNameNS(parsererrorNS,"parsererror").length>0&&(xmlDoc=null)}catch(err){xmlDoc=null}}else 0==xmlDocStr.indexOf("<?")&&(xmlDocStr=xmlDocStr.substr(xmlDocStr.indexOf("?>")+2)),xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),xmlDoc.async="false",xmlDoc.loadXML(xmlDocStr);return xmlDoc},this.asArray=function(prop){return void 0===prop||null==prop?[]:prop instanceof Array?prop:[prop]},this.toXmlDateTime=function(dt){return dt instanceof Date?dt.toISOString():"number"==typeof dt?new Date(dt).toISOString():null},this.asDateTime=function(prop){return"string"==typeof prop?fromXmlDateTime(prop):prop},this.xml2json=function(xmlDoc){return parseDOMChildren(xmlDoc)},this.xml_str2json=function(xmlDocStr){var xmlDoc=this.parseXmlString(xmlDocStr);return null!=xmlDoc?this.xml2json(xmlDoc):null},this.json2xml_str=function(jsonObj){return parseJSONObject(jsonObj,"")},this.json2xml=function(jsonObj){var xmlDocStr=this.json2xml_str(jsonObj);return this.parseXmlString(xmlDocStr)},this.getVersion=function(){return VERSION}}});
